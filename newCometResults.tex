%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Tracing Overhead
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{Tracing overhead}
\label{subsec:lowtoh}

\input{tabs.comet.newMed/comet_sd_pMpAcg_BC_itn_p3.5.tex}

Table \ref{comet_sd_pMpAcg_BC_itn_p3.5} shows the tracing overhead of \parlotm, \parlota, and \callgrind on each application of the NPB benchmark suite for different node counts. The last column of the table lists the geometric mean over all eight programs. The AVG rows show the average over the four node counts.

On average, both \parlotm and \parlota outperform \callgrind. The bolded numbers in Table \ref{comet_sd_pMpAcg_BC_itn_p3.5} for input C show that the average overhead is 1.94 for \parlotm, 2.73 for \parlota, and 4.63 for \callgrind. Figures \ref{comet_chartAvg_sd_B_p3_5} and \ref{comet_chartAvg_sd_C_p3_5} show these results in visual form.

Perhaps the key takeaway point is that the overhead of \parlot is roughly a factor of two to three, which we believe users are willing to accept if it helps them debug their applications. This is very promising especially when considering how detailed the collected trace information is. Similarly, it is reassuring to see that \parlot 's overhead is typically lower than that of \callgrind, which collects less information.

The overhead of \parlot increases as we scale the applications to more compute nodes. However, the increase is quite small. Going from 16 to 1024 cores, a 64-fold increase in parallelism, only increases the average overhead by between 1.3- and 2.1-fold. In contrast, \callgrind 's overhead decreases with increasing node count, making it more scalable. Having said that, \callgrind 's overhead is larger for the C inputs whereas \parlot 's overhead is larger for the smaller B inputs. In other words, \parlot scales better to larger inputs than \callgrind.

The reason for \parlot 's scaling behavior can be explained by correlating it with the expected function-call frequency. When distributing a fixed problem size over more cores, each core receives less work. As a consequence, less time is spent in the functions that process the work, resulting in more function calls per time unit, which causes more work for \parlot. In contrast, when distributing a larger problem size over the same number of cores, each core receives more work. Hence, more time is spent in the functions that process the work, resulting in fewer function calls per time unit, which causes less work for \parlot and therefore less tracing overhead. Hence, we believe \parlot 's overhead to be even lower on long-running inputs, which is where our tracing technique for debugging is needed the most.

In summary, \parlot 's overhead is in the single digits for all evaluated applications and configurations, including for 1024-core runs. It appears to scale reasonably to larger node counts and well to larger problem sizes.



\begin{figure}[t]
\centering
\includegraphics[width=3.2in]{figs.comet.newMed/comet_chartAvg_sd_B_p3_5.png}
\caption{ Input: B - Tracing Overhead
}
\label{comet_chartAvg_sd_B_p3_5}
\end{figure}


\begin{figure}[t]
\centering
\includegraphics[width=3.2in]{figs.comet.newMed/comet_chartAvg_sd_C_p3_5.png}
\caption{ Input: C - Tracing Overhead}
\label{comet_chartAvg_sd_C_p3_5}
\end{figure}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Banwidth
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


  
\subsection{Required Bandwidth}
\label{subsec:lowbw}

\input{tabs.comet.newMed/comet_bw_pMpAcg_BC_itn_p3.5.tex}

Table \ref{comet_bw_pMpAcg_BC_itn_p3.5} shows how much bandwidth each tool 
requires
during the application execution. 
%
We notice that \parlotm requires much less bandwidth compared to
\callgrind, especially for smaller inputs. 
%
\parlota's bandwidth is much higher, as it collects traces from all
functions, and not just the main function.


We observe from table \ref{comet_cr_pMpA_BC_itn_p3.5}, input C, that the
average compression ratio for \parlota is 644.38, and its
corresponding required bandwidth from table
\ref{comet_bw_pMpAcg_BC_itn_p3.5} is 56.38.
%
This which means \parlot can
collect \textbf{more than 36 MB} worth of data per core per second
while it only needs 56.38 kB/s of the system bandwidth, {\em leaving the rest of
the available system bandwidth for application.}
%
In comparison, \callgrind can only
collect \textbf{less than 100 kB} of traces and still adds more
overhead compared to either \parlota or \parlotm
(fig. \ref{comet_chartAvg_bw_B_p3_5},\ref{comet_chartAvg_bw_C_p3_5}). 
%
The average amount of traces that can be collected by \parlota is
\textbf{360x} (85x for \parlotm) larger than that for \callgrind.
%
Under the same circumstances,
\parlota also incurs much less overheads (the
average overhead that \parlota adds is 0.6x (0.4x for \parlotm)
of that caused by \callgrind).


\begin{figure}[t]
\centering
\includegraphics[width=3.2in]{figs.comet.newMed/comet_chartAvg_bw_B_p3_5.png}
\caption{ Input: \textbf{B} - Required Bandwidth per core (kB/s)
}
\label{comet_chartAvg_bw_B_p3_5}
\end{figure}



\begin{figure}[t]
\centering
\includegraphics[width=3.2in]{figs.comet.newMed/comet_chartAvg_bw_C_p3_5.png}
\caption{ Input: \textbf{C}  - Required Bandwidth per core (kB/s)
}
\label{comet_chartAvg_bw_C_p3_5}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  
\subsection{Compression Ratio}
\label{subsec:cr}

Table \ref{comet_cr_pMpA_BC_itn_p3.5} shows the compression ratios for all configurations and inputs. 
On average, \parlot can store up to more than 1700 MB of collected data in just 1 MB of trace files. 
In fact, observe that the compression mechanism of
\parlot achieved more than a 21k compression ratio (table \ref{comet_cr_pMpA_BC_itn_p3.5}, 
the entry for \parlotm, Input B, 1 node).
%
Furthermore, this result was achieved with low overhead and incremental (hence low-jitter) 
on the fly compression.
%
Generally, the obtained
compression ratios for \parlotm are higher than for \parlota. 
%
Since \parlota  collects library function calls in addition to calls from
the main image functions, 
we surmise that the probability of obtaining
redundant events in traces (which compression takes advantage of)
is lower for \parlota, thus causing its compression efficacy to drop.

  
\input{tabs.comet.newMed/comet_cr_pMpA_BC_itn_p3.5.tex}


\begin{figure}[t]
\centering
\includegraphics[width=3.2in]{figs.comet.newMed/comet_chartAvg_cr_C_p3_5.png}
\caption{ Input: \textbf{C}  - Compression Ratio
}
\label{comet_chartAvg_cr_C_p3_5}
\end{figure}


\begin{figure}[t]
\centering
\includegraphics[width=3.2in]{figs.comet.newMed/comet_chartAvg_cr_B_p3_5.png}
\caption{ Input: \textbf{B}  - Compression Ratio
}
\label{comet_chartAvg_cr_B_p3_5}
\end{figure}
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
  
\subsection{ \pininit Overhead} 
\label{subsec:pinit}
Tables \ref{comet_wo_det_Main_all_B_p3.5} and
\ref{comet_wo_det_All_all_B_p3.5} present the average overhead added to each
application by different variations of \parlot. 
%
The last row of these two tables
present information on the geometric mean.
%
More specifically, an entry ``$x$'' in this last row
is the geometric mean of all
the entries above it in the same column.
%
This information captures how much each
phase of \parlot slows down the native execution. 


In general, one 
expects the following inequality to hold:
 the added overhead of \pininit < that of \parlot
< that of \parlotnc. 
%
The highlighted cells in these tables do not
obey this inequality.
%
In fact, the variability across three runs of each experiment
is indeed observable from the bar graphs in figure \ref{comet_BX2_Main_16_B_p3_5}
where we present the minimum, maximum and median overheads.
%
These are the calculated
overheads of each experiment for each tool, for input size B, and for 16
nodes. 
%
This variability (which is similar to the variability observed for inputs and nodes)
justifies the inconsistency that we highlight in  tables
\ref{comet_wo_det_Main_all_B_p3.5} and
\ref{comet_wo_det_All_all_B_p3.5}.


Tables \ref{comet_wo_det_Main_all_B_p3.5} and
\ref{comet_wo_det_All_all_B_p3.5} show that on average, \pininit adds
an overhead of 3.28  and \parlota adds an overhead of 3.42. 
%
\textbf{Almost 96\%
of \parlota overhead is added by \pininit}. 
%
Numbers from \parlotm and
other inputs are follow the same pattern
(see fig. \ref{comet_chartDet_B_wc_byTool_p3_5} and \ref{comet_chartDet_C_wc_byTool_p3_5}). 
%
The overhead that \parlot design (regardless of overhead of \pininit) {\em adds}
to applications is extremely small.
%
We further observe that if we were to switch over to a different
instrumentation tool that is not as general as \pin but perhaps more
lightweight, the overall overheads would reduce even further. \\


\input{tabs.comet.newMed/comet_wo_det_Main_all_B_p3.5.tex}

\input{tabs.comet.newMed/comet_wo_det_All_all_B_p3.5.tex}

\begin{figure}[t]
\centering
\includegraphics[width=3.2in]{figs.comet.newMed/comet_chartDet_B_wc_byTool_p3_5.png}
\caption{ Input: \textbf{B} - Tracing overhead added to the native run by each tool}
\label{comet_chartDet_B_wc_byTool_p3_5}
\end{figure}


\begin{figure}[t]
\centering
\includegraphics[width=3.2in]{figs.comet.newMed/comet_chartDet_C_wc_byTool_p3_5.png}
\caption{ Input: \textbf{C} - Tracing overhead added to the native run by each tool
}
\label{comet_chartDet_C_wc_byTool_p3_5}
\end{figure}






\subsection{Compression impact} 
\label{subsec:compact}

The last evaluation metric we discuss is that of the impact of compression.
%
Fig. \ref{comet_chartDet_B_woc_byTool_p3_5} and Fig. \ref{comet_chartDet_C_woc_byTool_p3_5} show the 
impact of compression; they also motivate the importance of incorporating compression in a tracing
tool. 
%
On average, \parlotnc slows down the application execution almost \textbf{2x} more than \parlota. 
%
The average overhead 
across table \ref{comet_wo_det_All_all_B_p3.5} for \parlota is \textbf{3.42}.
%
The  corresponding figure for \parlotnc is \textbf{6.62}. 
%
The numbers of \parlotm and input C is following the same pattern. For example, \parlot-nc slows down the application execution almost \textbf{1.66x} more than \parlotm.



\begin{figure}[t]
\centering
\includegraphics[width=3.2in]{figs.comet.newMed/comet_chartDet_B_woc_byTool_p3_5.png}
\caption{ Input: B, Tracing overhead added by \pininit and \parlotnc
}
\label{comet_chartDet_B_woc_byTool_p3_5}
\end{figure}

\begin{figure}[t]
\centering
\includegraphics[width=3.2in]{figs.comet.newMed/comet_chartDet_C_woc_byTool_p3_5.png}
\caption{ Input: C, Tracing overhead added by \pininit and \parlotnc}
\label{comet_chartDet_C_woc_byTool_p3_5}
\end{figure}




\begin{figure}[t]
\centering
\includegraphics[width=3.2in]{figs.comet.newMed/comet_BX2_Main_16_B_p3_5.png}
\caption{ Variability of \parlotm overhead on 16 nodes (Input B)
}
\label{comet_BX2_Main_16_B_p3_5}
\end{figure}
